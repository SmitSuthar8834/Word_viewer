import 'reflect-metadata';
import { crtInjectPrefix, crtInputPrefix, crtOutputPrefix, crtValidationInputPrefix } from '../constants';
const moduleMetadataKey = 'module';
const viewElementMetadataKey = 'viewElement';
const interfaceDesignerItemMetadataKey = 'interfaceDesignerItem';
const requestHandlerMetadataKey = 'requestHandler';
const designTimeViewElementMetadataKey = 'designTimeViewElement';
const validatorMetadataKey = 'validator';
const converterMetadataKey = 'converter';
/**
 * @internal
 */
export function setModuleMetadata(metadata, type) {
    Reflect.defineMetadata(moduleMetadataKey, metadata, type);
}
/**
 * @internal
 */
export function getModuleMetadata(type) {
    const metadata = Reflect.getMetadata(moduleMetadataKey, type);
    if (!metadata) {
        throw new Error(`Module metadata was not found on '${type.name}' class`);
    }
    return metadata;
}
/**
 * @internal
 */
export function setViewElementMetadata(metadata, type) {
    Reflect.defineMetadata(viewElementMetadataKey, metadata, type);
}
/**
 * @internal
 */
export function getViewElementMetadata(type) {
    const metadata = Reflect.getMetadata(viewElementMetadataKey, type);
    if (!metadata) {
        throw new Error(`View element metadata was not found on '${type.name}' class`);
    }
    return metadata;
}
/**
 * @internal
 */
export function setValidatorMetadata(metadata, type) {
    Reflect.defineMetadata(validatorMetadataKey, metadata, type);
}
/**
 * @internal
 */
export function getValidatorMetadata(type) {
    const metadata = Reflect.getOwnMetadata(validatorMetadataKey, type);
    if (!metadata) {
        throw new Error(`Validator metadata was not found on '${type.name}' class`);
    }
    return metadata;
}
/**
 * @internal
 */
export function setConverterMetadata(metadata, type) {
    Reflect.defineMetadata(converterMetadataKey, metadata, type);
}
/**
 * @internal
 */
export function getConverterMetadata(type) {
    const metadata = Reflect.getOwnMetadata(converterMetadataKey, type);
    if (!metadata) {
        throw new Error(`Converter metadata was not found on '${type.name}' class`);
    }
    return metadata;
}
/**
 * @internal
 */
export function setInterfaceDesignerItemMetadata(metadata, type) {
    Reflect.defineMetadata(interfaceDesignerItemMetadataKey, metadata, type);
}
/**
 * @internal
 */
export function getInterfaceDesignerItemMetadata(type) {
    const metadata = Reflect.getOwnMetadata(interfaceDesignerItemMetadataKey, type);
    if (!metadata) {
        throw new Error(`Interface designer item metadata was not found on '${type.name}' class`);
    }
    return metadata;
}
/**
 * @internal
 */
export function setDesignTimeViewElementMetadata(metadata, type) {
    Reflect.defineMetadata(designTimeViewElementMetadataKey, metadata, type);
}
/**
 * @internal
 */
export function getDesignTimeViewElementMetadata(type) {
    const metadata = Reflect.getOwnMetadata(designTimeViewElementMetadataKey, type);
    if (!metadata) {
        throw new Error(`Design time view element metadata was not found on '${type.name}' class`);
    }
    return metadata;
}
/**
 * @internal
 */
export function hasInterfaceDesignerItemMetadata(type) {
    return Reflect.hasOwnMetadata(interfaceDesignerItemMetadataKey, type);
}
/**
 * @internal
 */
export function setRequestHandlerMetadata(metadata, type) {
    Reflect.defineMetadata(requestHandlerMetadataKey, metadata, type);
}
/**
 * @internal
 */
export function getRequestHandlerMetadata(type) {
    const metadata = Reflect.getMetadata(requestHandlerMetadataKey, type);
    if (!metadata) {
        throw new Error(`Request handler metadata was not found on '${type.name}' class`);
    }
    return metadata;
}
/**
 * @internal
 */
export function getHandlerChainServiceMetadata(typeRef) {
    const requestType = Reflect.getMetadata('requestType', typeRef);
    if (!requestType) {
        throw new Error(`requestType was not found on '${typeRef.name}' class`);
    }
    return { requestType, typeRef };
}
/**
 * @internal
 */
export function getCrtInputsMetadata(type) {
    const keys = Reflect.getMetadataKeys(type);
    const crtInputKeys = keys.filter((x) => x.startsWith(crtInputPrefix));
    return Object.fromEntries(crtInputKeys.map((key) => {
        const data = Reflect.getMetadata(key, type);
        return [key.replace(crtInputPrefix, ''), data];
    }));
}
/**
 * @internal
 */
export function getCrtOutputsMetadata(type) {
    const keys = Reflect.getMetadataKeys(type);
    const crtOutputKeys = keys.filter((x) => x.startsWith(crtOutputPrefix));
    return Object.fromEntries(crtOutputKeys.map((key) => {
        const data = Reflect.getMetadata(key, type);
        return [key.replace(crtOutputPrefix, ''), data];
    }));
}
/**
 * @internal
 */
export function getCrtValidationInputsMetadata(type) {
    const keys = Reflect.getMetadataKeys(type);
    const crtValidationInputKeys = keys.filter((x) => x.startsWith(crtValidationInputPrefix));
    return Object.fromEntries(crtValidationInputKeys.map((key) => {
        const data = Reflect.getMetadata(key, type);
        return [key.replace(crtValidationInputPrefix, ''), data];
    }));
}
/**
 * @internal
 */
function getCrtInjectMetadata(type) {
    const keys = Reflect.getOwnMetadataKeys(type);
    const crtInjectKeys = keys.filter((x) => x.startsWith(crtInjectPrefix));
    return Object.fromEntries(crtInjectKeys.map((key) => {
        const index = Number(key.replace(crtInjectPrefix, ''));
        const data = Reflect.getMetadata(key, type);
        return [index, data];
    }));
}
/**
 * @internal
 */
function getParentType(type) {
    const parentProto = type.prototype ? Object.getPrototypeOf(type.prototype) : null;
    return parentProto ? parentProto.constructor : null;
}
/**
 * @internal
 */
export function getTypeDependencies(type) {
    const paramTypes = Reflect.getOwnMetadata('design:paramtypes', type);
    if (!paramTypes) {
        if (type.length > 0) {
            throw new Error(`Dependency Injection error. Cannot read dependencies of class '${type.name}'. ` +
                `Please make sure class '${type.name}' has decorator and ` +
                "'emitDecoratorMetadata' option is enabled in your 'tsconfig.json' file.");
        }
        const parentType = getParentType(type);
        return parentType && parentType !== Object ? getTypeDependencies(parentType) : [];
    }
    const crtInjectMetadata = getCrtInjectMetadata(type);
    Object.entries(crtInjectMetadata).forEach(([index, token]) => (paramTypes[index] = token));
    return paramTypes;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGEtdXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2RldmtpdC9jb21tb24vc3JjL2xpYi9pbnRlcm5hbC91dGlscy9tZXRhZGF0YS11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGtCQUFrQixDQUFDO0FBWTFCLE9BQU8sRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQVExRyxNQUFNLGlCQUFpQixHQUFHLFFBQVEsQ0FBQztBQUNuQyxNQUFNLHNCQUFzQixHQUFHLGFBQWEsQ0FBQztBQUM3QyxNQUFNLGdDQUFnQyxHQUFHLHVCQUF1QixDQUFDO0FBQ2pFLE1BQU0seUJBQXlCLEdBQUcsZ0JBQWdCLENBQUM7QUFDbkQsTUFBTSxnQ0FBZ0MsR0FBRyx1QkFBdUIsQ0FBQztBQUNqRSxNQUFNLG9CQUFvQixHQUFHLFdBQVcsQ0FBQztBQUN6QyxNQUFNLG9CQUFvQixHQUFHLFdBQVcsQ0FBQztBQXdCekM7O0dBRUc7QUFDSCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsUUFBMEIsRUFBRSxJQUFVO0lBQ3ZFLE9BQU8sQ0FBQyxjQUFjLENBQUMsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzNELENBQUM7QUFFRDs7R0FFRztBQUNILE1BQU0sVUFBVSxpQkFBaUIsQ0FBQyxJQUFVO0lBQzNDLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUQsSUFBSSxDQUFDLFFBQVEsRUFBRTtRQUNkLE1BQU0sSUFBSSxLQUFLLENBQUMscUNBQXFDLElBQUksQ0FBQyxJQUFJLFNBQVMsQ0FBQyxDQUFDO0tBQ3pFO0lBQ0QsT0FBTyxRQUFRLENBQUM7QUFDakIsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFV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QUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2xGLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDckQsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLG1CQUFtQixDQUFDLElBQVU7SUFDN0MsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNyRSxJQUFJLENBQUMsVUFBVSxFQUFFO1FBQ2hCLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FDZCxrRUFBa0UsSUFBSSxDQUFDLElBQUksS0FBSztnQkFDL0UsMkJBQTJCLElBQUksQ0FBQyxJQUFJLHNCQUFzQjtnQkFDMUQseUVBQXlFLENBQzFFLENBQUM7U0FDRjtRQUNELE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QyxPQUFPLFVBQVUsSUFBSSxVQUFVLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0tBQ2xGO0lBQ0QsTUFBTSxpQkFBaUIsR0FBRyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNyRCxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDM0YsT0FBTyxVQUFVLENBQUM7QUFDbkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgeyBUeXBlIH0gZnJvbSAnLi4vLi4vYmFzZS1leHBvcnRzJztcbmltcG9ydCB7XG5cdEJhc2VWYWxpZGF0b3IsXG5cdENvbnZlcnRlcixcblx0Q3J0SW5wdXRSZWdpc3RyYXRpb25Db25maWcsXG5cdE1vZHVsZURlZmluaXRpb24sXG5cdFJlcXVlc3RIYW5kbGVyRGVmaW5pdGlvbixcblx0VmFsaWRhdG9yQ29uZmlnLFxuXHRWaWV3RWxlbWVudFJlZ2lzdHJhdGlvbkNvbmZpZyxcbn0gZnJvbSAnLi4vLi4vcHVibGljL21vZGVscyc7XG5pbXBvcnQgeyBJbnRlcmZhY2VEZXNpZ25lckl0ZW1EZWZpbml0aW9uIH0gZnJvbSAnLi4vLi4vcHVibGljL21vZGVscy9pbnRlcmZhY2UtZGVzaWduZXItaXRlbS9pbnRlcmZhY2UtZGVzaWduZXItaXRlbS1kZWZpbml0aW9uJztcbmltcG9ydCB7IGNydEluamVjdFByZWZpeCwgY3J0SW5wdXRQcmVmaXgsIGNydE91dHB1dFByZWZpeCwgY3J0VmFsaWRhdGlvbklucHV0UHJlZml4IH0gZnJvbSAnLi4vY29uc3RhbnRzJztcbmltcG9ydCB7XG5cdEFuZ3VsYXJWaWV3RWxlbWVudFJlZ2lzdHJhdGlvbkNvbmZpZyxcblx0RGVzaWduVGltZVZpZXdFbGVtZW50UmVnaXN0cnlJdGVtLFxuXHRIYW5kbGVyQ2hhaW5TZXJ2aWNlUmVnaXN0cnlJdGVtLFxuXHRJbnRlcm5hbEludGVyZmFjZURlc2lnbmVySXRlbVJlZ2lzdHJhdGlvbkNvbmZpZyxcbn0gZnJvbSAnLi4vbW9kZWxzJztcblxuY29uc3QgbW9kdWxlTWV0YWRhdGFLZXkgPSAnbW9kdWxlJztcbmNvbnN0IHZpZXdFbGVtZW50TWV0YWRhdGFLZXkgPSAndmlld0VsZW1lbnQnO1xuY29uc3QgaW50ZXJmYWNlRGVzaWduZXJJdGVtTWV0YWRhdGFLZXkgPSAnaW50ZXJmYWNlRGVzaWduZXJJdGVtJztcbmNvbnN0IHJlcXVlc3RIYW5kbGVyTWV0YWRhdGFLZXkgPSAncmVxdWVzdEhhbmRsZXInO1xuY29uc3QgZGVzaWduVGltZVZpZXdFbGVtZW50TWV0YWRhdGFLZXkgPSAnZGVzaWduVGltZVZpZXdFbGVtZW50JztcbmNvbnN0IHZhbGlkYXRvck1ldGFkYXRhS2V5ID0gJ3ZhbGlkYXRvcic7XG5jb25zdCBjb252ZXJ0ZXJNZXRhZGF0YUtleSA9ICdjb252ZXJ0ZXInO1xuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgdHlwZSBWaWV3RWxlbWVudE1ldGFkYXRhID0gVmlld0VsZW1lbnRSZWdpc3RyYXRpb25Db25maWcgfCBBbmd1bGFyVmlld0VsZW1lbnRSZWdpc3RyYXRpb25Db25maWc7XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCB0eXBlIEludGVyZmFjZURlc2lnbmVySXRlbU1ldGFkYXRhID1cblx0fCBJbnRlcmZhY2VEZXNpZ25lckl0ZW1EZWZpbml0aW9uXG5cdHwgSW50ZXJuYWxJbnRlcmZhY2VEZXNpZ25lckl0ZW1SZWdpc3RyYXRpb25Db25maWc7XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCB0eXBlIFZhbGlkYXRvck1ldGFkYXRhID0gVmFsaWRhdG9yQ29uZmlnICYgeyB0eXBlUmVmOiBUeXBlPEJhc2VWYWxpZGF0b3I+IH07XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29udmVydGVyTWV0YWRhdGEgeyB0eXBlOiBzdHJpbmc7IHR5cGVSZWY6IFR5cGU8Q29udmVydGVyPiB9XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRNb2R1bGVNZXRhZGF0YShtZXRhZGF0YTogTW9kdWxlRGVmaW5pdGlvbiwgdHlwZTogVHlwZSk6IHZvaWQge1xuXHRSZWZsZWN0LmRlZmluZU1ldGFkYXRhKG1vZHVsZU1ldGFkYXRhS2V5LCBtZXRhZGF0YSwgdHlwZSk7XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNb2R1bGVNZXRhZGF0YSh0eXBlOiBUeXBlKTogTW9kdWxlRGVmaW5pdGlvbiB7XG5cdGNvbnN0IG1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YShtb2R1bGVNZXRhZGF0YUtleSwgdHlwZSk7XG5cdGlmICghbWV0YWRhdGEpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYE1vZHVsZSBtZXRhZGF0YSB3YXMgbm90IGZvdW5kIG9uICcke3R5cGUubmFtZX0nIGNsYXNzYCk7XG5cdH1cblx0cmV0dXJuIG1ldGFkYXRhO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Vmlld0VsZW1lbnRNZXRhZGF0YShtZXRhZGF0YTogVmlld0VsZW1lbnRNZXRhZGF0YSwgdHlwZTogVHlwZSk6IHZvaWQge1xuXHRSZWZsZWN0LmRlZmluZU1ldGFkYXRhKHZpZXdFbGVtZW50TWV0YWRhdGFLZXksIG1ldGFkYXRhLCB0eXBlKTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFZpZXdFbGVtZW50TWV0YWRhdGEodHlwZTogVHlwZSk6IFZpZXdFbGVtZW50TWV0YWRhdGEge1xuXHRjb25zdCBtZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEodmlld0VsZW1lbnRNZXRhZGF0YUtleSwgdHlwZSk7XG5cdGlmICghbWV0YWRhdGEpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYFZpZXcgZWxlbWVudCBtZXRhZGF0YSB3YXMgbm90IGZvdW5kIG9uICcke3R5cGUubmFtZX0nIGNsYXNzYCk7XG5cdH1cblx0cmV0dXJuIG1ldGFkYXRhO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0VmFsaWRhdG9yTWV0YWRhdGEobWV0YWRhdGE6IFZhbGlkYXRvck1ldGFkYXRhLCB0eXBlOiBUeXBlKTogdm9pZCB7XG5cdFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEodmFsaWRhdG9yTWV0YWRhdGFLZXksIG1ldGFkYXRhLCB0eXBlKTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFZhbGlkYXRvck1ldGFkYXRhKHR5cGU6IFR5cGUpOiBWYWxpZGF0b3JNZXRhZGF0YSB7XG5cdGNvbnN0IG1ldGFkYXRhID0gUmVmbGVjdC5nZXRPd25NZXRhZGF0YSh2YWxpZGF0b3JNZXRhZGF0YUtleSwgdHlwZSk7XG5cdGlmICghbWV0YWRhdGEpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYFZhbGlkYXRvciBtZXRhZGF0YSB3YXMgbm90IGZvdW5kIG9uICcke3R5cGUubmFtZX0nIGNsYXNzYCk7XG5cdH1cblx0cmV0dXJuIG1ldGFkYXRhO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29udmVydGVyTWV0YWRhdGEobWV0YWRhdGE6IENvbnZlcnRlck1ldGFkYXRhLCB0eXBlOiBUeXBlKTogdm9pZCB7XG5cdFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoY29udmVydGVyTWV0YWRhdGFLZXksIG1ldGFkYXRhLCB0eXBlKTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbnZlcnRlck1ldGFkYXRhKHR5cGU6IFR5cGUpOiBDb252ZXJ0ZXJNZXRhZGF0YSB7XG5cdGNvbnN0IG1ldGFkYXRhID0gUmVmbGVjdC5nZXRPd25NZXRhZGF0YShjb252ZXJ0ZXJNZXRhZGF0YUtleSwgdHlwZSk7XG5cdGlmICghbWV0YWRhdGEpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYENvbnZlcnRlciBtZXRhZGF0YSB3YXMgbm90IGZvdW5kIG9uICcke3R5cGUubmFtZX0nIGNsYXNzYCk7XG5cdH1cblx0cmV0dXJuIG1ldGFkYXRhO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0SW50ZXJmYWNlRGVzaWduZXJJdGVtTWV0YWRhdGEobWV0YWRhdGE6IEludGVyZmFjZURlc2lnbmVySXRlbU1ldGFkYXRhLCB0eXBlOiBUeXBlKTogdm9pZCB7XG5cdFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoaW50ZXJmYWNlRGVzaWduZXJJdGVtTWV0YWRhdGFLZXksIG1ldGFkYXRhLCB0eXBlKTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEludGVyZmFjZURlc2lnbmVySXRlbU1ldGFkYXRhKHR5cGU6IFR5cGUpOiBJbnRlcmZhY2VEZXNpZ25lckl0ZW1NZXRhZGF0YSB7XG5cdGNvbnN0IG1ldGFkYXRhID0gUmVmbGVjdC5nZXRPd25NZXRhZGF0YShpbnRlcmZhY2VEZXNpZ25lckl0ZW1NZXRhZGF0YUtleSwgdHlwZSk7XG5cdGlmICghbWV0YWRhdGEpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEludGVyZmFjZSBkZXNpZ25lciBpdGVtIG1ldGFkYXRhIHdhcyBub3QgZm91bmQgb24gJyR7dHlwZS5uYW1lfScgY2xhc3NgKTtcblx0fVxuXHRyZXR1cm4gbWV0YWRhdGE7XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXREZXNpZ25UaW1lVmlld0VsZW1lbnRNZXRhZGF0YShtZXRhZGF0YTogRGVzaWduVGltZVZpZXdFbGVtZW50UmVnaXN0cnlJdGVtLCB0eXBlOiBUeXBlKTogdm9pZCB7XG5cdFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoZGVzaWduVGltZVZpZXdFbGVtZW50TWV0YWRhdGFLZXksIG1ldGFkYXRhLCB0eXBlKTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlc2lnblRpbWVWaWV3RWxlbWVudE1ldGFkYXRhKHR5cGU6IFR5cGUpOiBEZXNpZ25UaW1lVmlld0VsZW1lbnRSZWdpc3RyeUl0ZW0ge1xuXHRjb25zdCBtZXRhZGF0YSA9IFJlZmxlY3QuZ2V0T3duTWV0YWRhdGEoZGVzaWduVGltZVZpZXdFbGVtZW50TWV0YWRhdGFLZXksIHR5cGUpO1xuXHRpZiAoIW1ldGFkYXRhKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKGBEZXNpZ24gdGltZSB2aWV3IGVsZW1lbnQgbWV0YWRhdGEgd2FzIG5vdCBmb3VuZCBvbiAnJHt0eXBlLm5hbWV9JyBjbGFzc2ApO1xuXHR9XG5cdHJldHVybiBtZXRhZGF0YTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhhc0ludGVyZmFjZURlc2lnbmVySXRlbU1ldGFkYXRhKHR5cGU6IFR5cGUpOiBib29sZWFuIHtcblx0cmV0dXJuIFJlZmxlY3QuaGFzT3duTWV0YWRhdGEoaW50ZXJmYWNlRGVzaWduZXJJdGVtTWV0YWRhdGFLZXksIHR5cGUpO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0UmVxdWVzdEhhbmRsZXJNZXRhZGF0YShtZXRhZGF0YTogUmVxdWVzdEhhbmRsZXJEZWZpbml0aW9uLCB0eXBlOiBUeXBlKTogdm9pZCB7XG5cdFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEocmVxdWVzdEhhbmRsZXJNZXRhZGF0YUtleSwgbWV0YWRhdGEsIHR5cGUpO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVxdWVzdEhhbmRsZXJNZXRhZGF0YSh0eXBlOiBUeXBlKTogUmVxdWVzdEhhbmRsZXJEZWZpbml0aW9uIHtcblx0Y29uc3QgbWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKHJlcXVlc3RIYW5kbGVyTWV0YWRhdGFLZXksIHR5cGUpO1xuXHRpZiAoIW1ldGFkYXRhKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKGBSZXF1ZXN0IGhhbmRsZXIgbWV0YWRhdGEgd2FzIG5vdCBmb3VuZCBvbiAnJHt0eXBlLm5hbWV9JyBjbGFzc2ApO1xuXHR9XG5cdHJldHVybiBtZXRhZGF0YTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEhhbmRsZXJDaGFpblNlcnZpY2VNZXRhZGF0YSh0eXBlUmVmOiBUeXBlKTogSGFuZGxlckNoYWluU2VydmljZVJlZ2lzdHJ5SXRlbSB7XG5cdGNvbnN0IHJlcXVlc3RUeXBlID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgncmVxdWVzdFR5cGUnLCB0eXBlUmVmKTtcblx0aWYgKCFyZXF1ZXN0VHlwZSkge1xuXHRcdHRocm93IG5ldyBFcnJvcihgcmVxdWVzdFR5cGUgd2FzIG5vdCBmb3VuZCBvbiAnJHt0eXBlUmVmLm5hbWV9JyBjbGFzc2ApO1xuXHR9XG5cdHJldHVybiB7IHJlcXVlc3RUeXBlLCB0eXBlUmVmIH07XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDcnRJbnB1dHNNZXRhZGF0YSh0eXBlOiBUeXBlKTogUmVjb3JkPHN0cmluZywgQ3J0SW5wdXRSZWdpc3RyYXRpb25Db25maWc+IHtcblx0Y29uc3Qga2V5cyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGFLZXlzKHR5cGUpO1xuXHRjb25zdCBjcnRJbnB1dEtleXMgPSBrZXlzLmZpbHRlcigoeDogc3RyaW5nKSA9PiB4LnN0YXJ0c1dpdGgoY3J0SW5wdXRQcmVmaXgpKTtcblx0cmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcblx0XHRjcnRJbnB1dEtleXMubWFwKChrZXkpID0+IHtcblx0XHRcdGNvbnN0IGRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKGtleSwgdHlwZSk7XG5cdFx0XHRyZXR1cm4gW2tleS5yZXBsYWNlKGNydElucHV0UHJlZml4LCAnJyksIGRhdGFdO1xuXHRcdH0pLFxuXHQpO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3J0T3V0cHV0c01ldGFkYXRhKHR5cGU6IFR5cGUpOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB7XG5cdGNvbnN0IGtleXMgPSBSZWZsZWN0LmdldE1ldGFkYXRhS2V5cyh0eXBlKTtcblx0Y29uc3QgY3J0T3V0cHV0S2V5cyA9IGtleXMuZmlsdGVyKCh4OiBzdHJpbmcpID0+IHguc3RhcnRzV2l0aChjcnRPdXRwdXRQcmVmaXgpKTtcblx0cmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcblx0XHRjcnRPdXRwdXRLZXlzLm1hcCgoa2V5KSA9PiB7XG5cdFx0XHRjb25zdCBkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YShrZXksIHR5cGUpO1xuXHRcdFx0cmV0dXJuIFtrZXkucmVwbGFjZShjcnRPdXRwdXRQcmVmaXgsICcnKSwgZGF0YV07XG5cdFx0fSksXG5cdCk7XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDcnRWYWxpZGF0aW9uSW5wdXRzTWV0YWRhdGEodHlwZTogVHlwZSk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcblx0Y29uc3Qga2V5cyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGFLZXlzKHR5cGUpO1xuXHRjb25zdCBjcnRWYWxpZGF0aW9uSW5wdXRLZXlzID0ga2V5cy5maWx0ZXIoKHg6IHN0cmluZykgPT4geC5zdGFydHNXaXRoKGNydFZhbGlkYXRpb25JbnB1dFByZWZpeCkpO1xuXHRyZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuXHRcdGNydFZhbGlkYXRpb25JbnB1dEtleXMubWFwKChrZXkpID0+IHtcblx0XHRcdGNvbnN0IGRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKGtleSwgdHlwZSk7XG5cdFx0XHRyZXR1cm4gW2tleS5yZXBsYWNlKGNydFZhbGlkYXRpb25JbnB1dFByZWZpeCwgJycpLCBkYXRhXTtcblx0XHR9KSxcblx0KTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gZ2V0Q3J0SW5qZWN0TWV0YWRhdGEodHlwZTogVHlwZSk6IFJlY29yZDxudW1iZXIsIHVua25vd24+IHtcblx0Y29uc3Qga2V5cyA9IFJlZmxlY3QuZ2V0T3duTWV0YWRhdGFLZXlzKHR5cGUpO1xuXHRjb25zdCBjcnRJbmplY3RLZXlzID0ga2V5cy5maWx0ZXIoKHg6IHN0cmluZykgPT4geC5zdGFydHNXaXRoKGNydEluamVjdFByZWZpeCkpO1xuXHRyZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuXHRcdGNydEluamVjdEtleXMubWFwKChrZXkpID0+IHtcblx0XHRcdGNvbnN0IGluZGV4ID0gTnVtYmVyKGtleS5yZXBsYWNlKGNydEluamVjdFByZWZpeCwgJycpKTtcblx0XHRcdGNvbnN0IGRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKGtleSwgdHlwZSk7XG5cdFx0XHRyZXR1cm4gW2luZGV4LCBkYXRhXTtcblx0XHR9KSxcblx0KTtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gZ2V0UGFyZW50VHlwZSh0eXBlOiBUeXBlKTogVHlwZSB7XG5cdGNvbnN0IHBhcmVudFByb3RvID0gdHlwZS5wcm90b3R5cGUgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YodHlwZS5wcm90b3R5cGUpIDogbnVsbDtcblx0cmV0dXJuIHBhcmVudFByb3RvID8gcGFyZW50UHJvdG8uY29uc3RydWN0b3IgOiBudWxsO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0VHlwZURlcGVuZGVuY2llcyh0eXBlOiBUeXBlKTogdW5rbm93bltdIHtcblx0Y29uc3QgcGFyYW1UeXBlcyA9IFJlZmxlY3QuZ2V0T3duTWV0YWRhdGEoJ2Rlc2lnbjpwYXJhbXR5cGVzJywgdHlwZSk7XG5cdGlmICghcGFyYW1UeXBlcykge1xuXHRcdGlmICh0eXBlLmxlbmd0aCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0YERlcGVuZGVuY3kgSW5qZWN0aW9uIGVycm9yLiBDYW5ub3QgcmVhZCBkZXBlbmRlbmNpZXMgb2YgY2xhc3MgJyR7dHlwZS5uYW1lfScuIGAgK1xuXHRcdFx0XHRcdGBQbGVhc2UgbWFrZSBzdXJlIGNsYXNzICcke3R5cGUubmFtZX0nIGhhcyBkZWNvcmF0b3IgYW5kIGAgK1xuXHRcdFx0XHRcdFwiJ2VtaXREZWNvcmF0b3JNZXRhZGF0YScgb3B0aW9uIGlzIGVuYWJsZWQgaW4geW91ciAndHNjb25maWcuanNvbicgZmlsZS5cIixcblx0XHRcdCk7XG5cdFx0fVxuXHRcdGNvbnN0IHBhcmVudFR5cGUgPSBnZXRQYXJlbnRUeXBlKHR5cGUpO1xuXHRcdHJldHVybiBwYXJlbnRUeXBlICYmIHBhcmVudFR5cGUgIT09IE9iamVjdCA/IGdldFR5cGVEZXBlbmRlbmNpZXMocGFyZW50VHlwZSkgOiBbXTtcblx0fVxuXHRjb25zdCBjcnRJbmplY3RNZXRhZGF0YSA9IGdldENydEluamVjdE1ldGFkYXRhKHR5cGUpO1xuXHRPYmplY3QuZW50cmllcyhjcnRJbmplY3RNZXRhZGF0YSkuZm9yRWFjaCgoW2luZGV4LCB0b2tlbl0pID0+IChwYXJhbVR5cGVzW2luZGV4XSA9IHRva2VuKSk7XG5cdHJldHVybiBwYXJhbVR5cGVzO1xufVxuIl19