import { __decorate, __metadata } from "tslib";
import { Exclude } from 'class-transformer';
import { ɵencodeDate } from '../../../../../external/utils';
import { ɵDataValueType } from '../../../../../public/enums';
import { ɵExpressionType } from '../../enums';
import { ɵBaseExpression } from '../base-expression';
export class ɵParameterExpression extends ɵBaseExpression {
    /**
     * @internal
     * @dontChange
     */
    static get _instanceOfKeys() {
        return [...ɵBaseExpression._instanceOfKeys, this._instanceOfKey];
    }
    constructor(config) {
        super(config);
        this.expressionType = ɵExpressionType.Parameter;
        const value = config?.value;
        if (value instanceof Date) {
            const cloneDate = new Date();
            cloneDate.setTime(value.getTime());
            this.value = cloneDate;
        }
        else if (!value) {
            this.value = value;
        }
        else {
            this.value = typeof value === 'object' ? { ...value } : value;
        }
        this.dataValueType = config?.dataValueType ?? ɵDataValueType.Text;
        this.parameter = {
            dataValueType: this.dataValueType,
            ...this._getParameterValueMetadata(),
        };
    }
    /**
     * Parses expression from json.
     * @public
     */
    static fromJson(dto) {
        const expression = new ɵParameterExpression(dto['parameter']);
        return expression;
    }
    _convertStringToBlobArray(str) {
        const out = [];
        let position = 0;
        for (let i = 0; i < str.length; i++) {
            const code = str.charCodeAt(i);
            if (code < 128) {
                out[position++] = String.fromCharCode(code);
            }
            else if (code < 2048) {
                /* eslint-disable no-bitwise */
                out[position++] = String.fromCharCode((code >> 6) | 192);
                out[position++] = String.fromCharCode((code & 63) | 128);
            }
            else {
                out[position++] = String.fromCharCode((code >> 12) | 224);
                out[position++] = String.fromCharCode(((code >> 6) & 63) | 128);
                out[position++] = String.fromCharCode((code & 63) | 128);
                /* eslint-enable no-bitwise */
            }
        }
        return out;
    }
    _getParameterValueMetadata() {
        if (this.dataValueType === ɵDataValueType.Blob) {
            return {
                arrayValue: !this.value ? [] : this._convertStringToBlobArray(this.value),
            };
        }
        else if (this.value instanceof Date) {
            return {
                value: ɵencodeDate(this.value),
            };
        }
        else {
            return {
                value: this.value,
            };
        }
    }
    clone() {
        return new ɵParameterExpression(this);
    }
}
/**
 * @internal
 * @dontChange
 */
ɵParameterExpression._instanceOfKey = 'devkit_ParameterExpression';
__decorate([
    Exclude(),
    __metadata("design:type", Object)
], ɵParameterExpression.prototype, "value", void 0);
__decorate([
    Exclude(),
    __metadata("design:type", Number)
], ɵParameterExpression.prototype, "dataValueType", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVyLWV4cHJlc3Npb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2RldmtpdC9iYXNlL3NyYy9saWIvcHVibGljL2VzcS9kYXRhLW1vZGVsL2V4cHJlc3Npb25zL3BhcmFtZXRlcnMvcGFyYW1ldGVyLWV4cHJlc3Npb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUU1QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDNUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRzdELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDOUMsT0FBTyxFQUFFLGVBQWUsRUFBcUIsTUFBTSxvQkFBb0IsQ0FBQztBQUl4RSxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsZUFBZTtJQU94RDs7O09BR0c7SUFDTyxNQUFNLEtBQUssZUFBZTtRQUNuQyxPQUFPLENBQUMsR0FBRyxlQUFlLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBZ0JELFlBQVksTUFBa0M7UUFDN0MsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBZkMsbUJBQWMsR0FBb0IsZUFBZSxDQUFDLFNBQVMsQ0FBQztRQWdCM0UsTUFBTSxLQUFLLEdBQUcsTUFBTSxFQUFFLEtBQUssQ0FBQztRQUM1QixJQUFJLEtBQUssWUFBWSxJQUFJLEVBQUU7WUFDMUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUM3QixTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDO1NBQ3ZCO2FBQU0sSUFBSSxDQUFDLEtBQUss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LElBQUksQ0FBQyxLQUFLO2FBQ2pCLENBQUM7U0FDRjtJQUNGLENBQUM7SUFFTSxLQUFLO1FBQ1gsT0FBTyxJQUFJLG9CQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7O0FBbEdEOzs7R0FHRztBQUN1QixtQ0FBYyxHQUFXLDRCQUE0QixDQUFDO0FBWWhGO0lBQUMsT0FBTyxFQUFFOzttREFDZ0M7QUFFMUM7SUFBQyxPQUFPLEVBQUU7OzJEQUNvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV4Y2x1ZGUgfSBmcm9tICdjbGFzcy10cmFuc2Zvcm1lcic7XG5cbmltcG9ydCB7IMm1ZW5jb2RlRGF0ZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2V4dGVybmFsL3V0aWxzJztcbmltcG9ydCB7IMm1RGF0YVZhbHVlVHlwZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3B1YmxpYy9lbnVtcyc7XG5pbXBvcnQgeyDJtUxvb2t1cFZhbHVlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vcHVibGljL21vZGVscyc7XG5pbXBvcnQgeyDJtUVudGl0eUNvbHVtblZhbHVlLCDJtUpzb25PYmplY3QgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9wdWJsaWMvdHlwZXMnO1xuaW1wb3J0IHsgybVFeHByZXNzaW9uVHlwZSB9IGZyb20gJy4uLy4uL2VudW1zJztcbmltcG9ydCB7IMm1QmFzZUV4cHJlc3Npb24sIMm1RXhwcmVzc2lvbkNvbmZpZyB9IGZyb20gJy4uL2Jhc2UtZXhwcmVzc2lvbic7XG5cbmV4cG9ydCB0eXBlIMm1UGFyYW1ldGVyRXhwcmVzc2lvbkNvbmZpZyA9IMm1RXhwcmVzc2lvbkNvbmZpZzzJtVBhcmFtZXRlckV4cHJlc3Npb24+ICYgUGljazzJtVBhcmFtZXRlckV4cHJlc3Npb24sICd2YWx1ZSc+O1xuXG5leHBvcnQgY2xhc3MgybVQYXJhbWV0ZXJFeHByZXNzaW9uIGV4dGVuZHMgybVCYXNlRXhwcmVzc2lvbiB7XG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQGRvbnRDaGFuZ2Vcblx0ICovXG5cdHByb3RlY3RlZCBzdGF0aWMgcmVhZG9ubHkgX2luc3RhbmNlT2ZLZXk6IHN0cmluZyA9ICdkZXZraXRfUGFyYW1ldGVyRXhwcmVzc2lvbic7XG5cblx0LyoqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAZG9udENoYW5nZVxuXHQgKi9cblx0cHJvdGVjdGVkIHN0YXRpYyBnZXQgX2luc3RhbmNlT2ZLZXlzKCk6IHN0cmluZ1tdIHtcblx0XHRyZXR1cm4gWy4uLsm1QmFzZUV4cHJlc3Npb24uX2luc3RhbmNlT2ZLZXlzLCB0aGlzLl9pbnN0YW5jZU9mS2V5XTtcblx0fVxuXG5cdHB1YmxpYyByZWFkb25seSBleHByZXNzaW9uVHlwZTogybVFeHByZXNzaW9uVHlwZSA9IMm1RXhwcmVzc2lvblR5cGUuUGFyYW1ldGVyO1xuXG5cdEBFeGNsdWRlKClcblx0cHVibGljIHJlYWRvbmx5IHZhbHVlOiDJtUVudGl0eUNvbHVtblZhbHVlO1xuXG5cdEBFeGNsdWRlKClcblx0cHVibGljIHJlYWRvbmx5IGRhdGFWYWx1ZVR5cGU6IMm1RGF0YVZhbHVlVHlwZTtcblxuXHRwdWJsaWMgcmVhZG9ubHkgcGFyYW1ldGVyOiB7XG5cdFx0dmFsdWU/OiDJtUVudGl0eUNvbHVtblZhbHVlO1xuXHRcdGFycmF5VmFsdWU/OiBzdHJpbmdbXTtcblx0XHRkYXRhVmFsdWVUeXBlOiDJtURhdGFWYWx1ZVR5cGU7XG5cdH07XG5cblx0Y29uc3RydWN0b3IoY29uZmlnOiDJtVBhcmFtZXRlckV4cHJlc3Npb25Db25maWcpIHtcblx0XHRzdXBlcihjb25maWcpO1xuXHRcdGNvbnN0IHZhbHVlID0gY29uZmlnPy52YWx1ZTtcblx0XHRpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG5cdFx0XHRjb25zdCBjbG9uZURhdGUgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0Y2xvbmVEYXRlLnNldFRpbWUodmFsdWUuZ2V0VGltZSgpKTtcblx0XHRcdHRoaXMudmFsdWUgPSBjbG9uZURhdGU7XG5cdFx0fSBlbHNlIGlmICghdmFsdWUpIHtcblx0XHRcdHRoaXMudmFsdWUgPSB2YWx1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy52YWx1ZSA9IHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgPyB7IC4uLih2YWx1ZSBhcyDJtUxvb2t1cFZhbHVlKSB9IDogdmFsdWU7XG5cdFx0fVxuXHRcdHRoaXMuZGF0YVZhbHVlVHlwZSA9IGNvbmZpZz8uZGF0YVZhbHVlVHlwZSA/PyDJtURhdGFWYWx1ZVR5cGUuVGV4dDtcblx0XHR0aGlzLnBhcmFtZXRlciA9IHtcblx0XHRcdGRhdGFWYWx1ZVR5cGU6IHRoaXMuZGF0YVZhbHVlVHlwZSxcblx0XHRcdC4uLnRoaXMuX2dldFBhcmFtZXRlclZhbHVlTWV0YWRhdGEoKSxcblx0XHR9O1xuXHR9XG5cblx0LyoqXG5cdCAqIFBhcnNlcyBleHByZXNzaW9uIGZyb20ganNvbi5cblx0ICogQHB1YmxpY1xuXHQgKi9cblx0cHVibGljIHN0YXRpYyBmcm9tSnNvbihkdG86IMm1SnNvbk9iamVjdCk6IMm1UGFyYW1ldGVyRXhwcmVzc2lvbiB7XG5cdFx0Y29uc3QgZXhwcmVzc2lvbiA9IG5ldyDJtVBhcmFtZXRlckV4cHJlc3Npb24oZHRvWydwYXJhbWV0ZXInXSBhcyB1bmtub3duIGFzIMm1UGFyYW1ldGVyRXhwcmVzc2lvbkNvbmZpZyk7XG5cdFx0cmV0dXJuIGV4cHJlc3Npb247XG5cdH1cblxuXHRwcml2YXRlIF9jb252ZXJ0U3RyaW5nVG9CbG9iQXJyYXkoc3RyOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG5cdFx0Y29uc3Qgb3V0OiBzdHJpbmdbXSA9IFtdO1xuXHRcdGxldCBwb3NpdGlvbiA9IDA7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNvbnN0IGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTtcblx0XHRcdGlmIChjb2RlIDwgMTI4KSB7XG5cdFx0XHRcdG91dFtwb3NpdGlvbisrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG5cdFx0XHR9IGVsc2UgaWYgKGNvZGUgPCAyMDQ4KSB7XG5cdFx0XHRcdC8qIGVzbGludC1kaXNhYmxlIG5vLWJpdHdpc2UgKi9cblx0XHRcdFx0b3V0W3Bvc2l0aW9uKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoY29kZSA+PiA2KSB8IDE5Mik7XG5cdFx0XHRcdG91dFtwb3NpdGlvbisrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGNvZGUgJiA2MykgfCAxMjgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0b3V0W3Bvc2l0aW9uKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoY29kZSA+PiAxMikgfCAyMjQpO1xuXHRcdFx0XHRvdXRbcG9zaXRpb24rK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoY29kZSA+PiA2KSAmIDYzKSB8IDEyOCk7XG5cdFx0XHRcdG91dFtwb3NpdGlvbisrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGNvZGUgJiA2MykgfCAxMjgpO1xuXHRcdFx0XHQvKiBlc2xpbnQtZW5hYmxlIG5vLWJpdHdpc2UgKi9cblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIG91dDtcblx0fVxuXG5cdHByaXZhdGUgX2dldFBhcmFtZXRlclZhbHVlTWV0YWRhdGEoKToge1xuXHRcdHZhbHVlPzogybVFbnRpdHlDb2x1bW5WYWx1ZTtcblx0XHRhcnJheVZhbHVlPzogc3RyaW5nW107XG5cdH0ge1xuXHRcdGlmICh0aGlzLmRhdGFWYWx1ZVR5cGUgPT09IMm1RGF0YVZhbHVlVHlwZS5CbG9iKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRhcnJheVZhbHVlOiAhdGhpcy52YWx1ZSA/IFtdIDogdGhpcy5fY29udmVydFN0cmluZ1RvQmxvYkFycmF5KHRoaXMudmFsdWUgYXMgc3RyaW5nKSxcblx0XHRcdH07XG5cdFx0fSBlbHNlIGlmICh0aGlzLnZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0dmFsdWU6IMm1ZW5jb2RlRGF0ZSh0aGlzLnZhbHVlKSxcblx0XHRcdH07XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHZhbHVlOiB0aGlzLnZhbHVlLFxuXHRcdFx0fTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgY2xvbmUoKTogybVQYXJhbWV0ZXJFeHByZXNzaW9uIHtcblx0XHRyZXR1cm4gbmV3IMm1UGFyYW1ldGVyRXhwcmVzc2lvbih0aGlzKTtcblx0fVxufVxuIl19