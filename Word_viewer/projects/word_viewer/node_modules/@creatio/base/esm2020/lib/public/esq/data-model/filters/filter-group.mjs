import { __decorate, __metadata } from "tslib";
import { Exclude, Expose } from 'class-transformer';
import { ɵBaseFilter } from './base-filter';
import { ɵBetweenFilter } from './between-filter';
import { ɵCompareFilter } from './compare-filter';
import { ɵExistsFilter } from './exists-filter';
import { ɵInFilter } from './in-filter';
import { ɵIsNullFilter } from './isnull-filter';
import { ɵgenerateGuid } from '../../../../public/types';
import { ɵValidationUtilities } from '../../../exceptions';
import { ɵComparisonType } from '../enums/comparison-type.enum';
import { ɵFilterType } from '../enums/filter-type.enum';
import { ɵLogicalOperatorType } from '../enums/logical-operator-type.enum';
import { ɵColumnExpression } from '../expressions/columns/column-expression';
import { ɵParameterExpression } from '../expressions/parameters/parameter-expression';
export class ɵFilterGroup extends ɵBaseFilter {
    /**
     * @internal
     * @dontChange
     */
    static get _instanceOfKeys() {
        return [...ɵBaseFilter._instanceOfKeys, this._instanceOfKey];
    }
    get items() {
        const result = {};
        this.filters.forEach((filter, key) => {
            result[key] = this.serializeItem(filter);
        });
        return result;
    }
    constructor(logicalOperation = ɵLogicalOperatorType.And) {
        super(ɵFilterType.FilterGroup);
        this.filters = new Map();
        this.logicalOperation = logicalOperation;
    }
    /**
     * Parses filter group from json.
     * @public
     */
    static fromJson(dto, filterParser) {
        const logicalOperation = dto['logicalOperation'];
        const group = new ɵFilterGroup(logicalOperation || ɵLogicalOperatorType.And);
        Object.entries(dto['items']).forEach(([key, filterDTO]) => {
            group.add(filterParser.fromJson(filterDTO), key);
        });
        return group;
    }
    /**
     * Returns filter item by index.
     * @param index Item index.
     * @returns Filter.
     */
    getItemByIndex(index) {
        return this.items[Object.keys(this.items)[index]];
    }
    /**
     * Creates and adds compare filter by value.
     * @param comparisonType Comparison type.
     * @param columnPath Column path.
     * @param parameterValue Parameter value.
     * @param filterKey Filter key.
     */
    addSchemaColumnFilterWithParameter(comparisonType, columnPath, parameterValue, filterKey) {
        const leftExpression = new ɵColumnExpression({ columnPath });
        const rightExpression = new ɵParameterExpression({ value: parameterValue });
        const filter = new ɵCompareFilter(comparisonType, leftExpression, rightExpression);
        this.add(filter, filterKey);
    }
    /**
     * Creates and adds in filter by values.
     * @param comparisonType Comparison type.
     * @param columnPath Column path.
     * @param parameterValues Parameter values.
     * @param filterKey Filter key.
     */
    addSchemaColumnInFilterWithParameters(comparisonType, columnPath, parameterValues, filterKey) {
        const leftExpression = new ɵColumnExpression({ columnPath });
        const expressions = parameterValues.map((singleParameterValue) => new ɵParameterExpression({
            value: singleParameterValue,
        }));
        const filter = new ɵInFilter(comparisonType, leftExpression, expressions);
        this.add(filter, filterKey);
    }
    addSchemaColumnIsNullFilter(columnPath, filterKey) {
        const leftExpression = new ɵColumnExpression({ columnPath });
        const filter = new ɵIsNullFilter(ɵComparisonType.Is_null, leftExpression);
        this.add(filter, filterKey);
    }
    /**
     * Creates and adds not null filter.
     * @param columnPath Column path.
     * @param filterKey Filter key.
     */
    addSchemaColumnIsNotNullFilter(columnPath, filterKey) {
        const leftExpression = new ɵColumnExpression({ columnPath });
        const filter = new ɵIsNullFilter(ɵComparisonType.Is_not_null, leftExpression);
        this.add(filter, filterKey);
    }
    /**
     * Creates and adds filter between less value and greater value.
     * @param columnPath Column path.
     * @param lessParamValue Less parameter value.
     * @param greaterParamValue Greater parameter value.
     * @param filterKey Filter key.
     */
    addSchemaColumnBetweenFilterWithParameters(columnPath, lessParamValue, greaterParamValue, filterKey) {
        const leftExpression = new ɵColumnExpression({ columnPath });
        const rightLessExpression = new ɵParameterExpression({ value: lessParamValue });
        const rightGreaterExpression = new ɵParameterExpression({ value: greaterParamValue });
        const filter = new ɵBetweenFilter(leftExpression, rightLessExpression, rightGreaterExpression);
        this.add(filter, filterKey);
    }
    addExistsFilter(columnPath, subFilters, filterKey) {
        const leftExpression = new ɵColumnExpression({ columnPath });
        const filter = new ɵExistsFilter(leftExpression, subFilters);
        this.add(filter, filterKey);
    }
    addNotExistsFilter(columnPath, subFilters, filterKey) {
        const leftExpression = new ɵColumnExpression({ columnPath });
        const filter = new ɵExistsFilter(leftExpression, subFilters, ɵComparisonType.Not_exists);
        this.add(filter, filterKey);
    }
    add(filter, filterKey) {
        ɵValidationUtilities.checkArgumentEmpty('filter', filter);
        const key = filterKey || ɵgenerateGuid();
        this.filters.set(key, filter);
    }
    clone() {
        const filterGroup = new ɵFilterGroup(this.logicalOperation);
        this.filters.forEach((filter, filterKey) => {
            filterGroup.filters.set(filterKey, filter.clone());
        });
        return filterGroup;
    }
}
/**
 * @internal
 * @dontChange
 */
ɵFilterGroup._instanceOfKey = 'devkit_FilterGroup';
__decorate([
    Exclude(),
    __metadata("design:type", Object)
], ɵFilterGroup.prototype, "filters", void 0);
__decorate([
    Expose(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [])
], ɵFilterGroup.prototype, "items", null);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWdyb3VwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9kZXZraXQvYmFzZS9zcmMvbGliL3B1YmxpYy9lc3EvZGF0YS1tb2RlbC9maWx0ZXJzL2ZpbHRlci1ncm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRWhELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDeEMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBc0IsYUFBYSxFQUFzQixNQUFNLDBCQUEwQixDQUFDO0FBQ2pHLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzNELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDeEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDN0UsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFFdEYsTUFBTSxPQUFPLFlBQWEsU0FBUSxXQUFXO0lBTzVDOzs7T0FHRztJQUNPLE1BQU0sS0FBSyxlQUFlO1FBQ25DLE9BQU8sQ0FBQyxHQUFHLFdBQVcs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Qzs7QUEvSkQ7OztHQUdHO0FBQ3VCLDJCQUFjLEdBQVcsb0JBQW9CLENBQUM7QUFVeEU7SUFBQyxPQUFPLEVBQUU7OzZDQUNxQztBQUUvQztJQUFDLE1BQU0sRUFBRTs7O3lDQU9SIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXhjbHVkZSwgRXhwb3NlIH0gZnJvbSAnY2xhc3MtdHJhbnNmb3JtZXInO1xuXG5pbXBvcnQgeyDJtUJhc2VGaWx0ZXIgfSBmcm9tICcuL2Jhc2UtZmlsdGVyJztcbmltcG9ydCB7IMm1QmV0d2VlbkZpbHRlciB9IGZyb20gJy4vYmV0d2Vlbi1maWx0ZXInO1xuaW1wb3J0IHsgybVDb21wYXJlRmlsdGVyIH0gZnJvbSAnLi9jb21wYXJlLWZpbHRlcic7XG5pbXBvcnQgeyDJtUV4aXN0c0ZpbHRlciB9IGZyb20gJy4vZXhpc3RzLWZpbHRlcic7XG5pbXBvcnQgeyDJtUJhc2VGaWx0ZXJQYXJzZXIgfSBmcm9tICcuL2ZpbHRlci1wYXJzZXIvYmFzZS1maWx0ZXItcGFyc2VyJztcbmltcG9ydCB7IMm1SW5GaWx0ZXIgfSBmcm9tICcuL2luLWZpbHRlcic7XG5pbXBvcnQgeyDJtUlzTnVsbEZpbHRlciB9IGZyb20gJy4vaXNudWxsLWZpbHRlcic7XG5pbXBvcnQgeyDJtUVudGl0eUNvbHVtblZhbHVlLCDJtWdlbmVyYXRlR3VpZCwgybVHdWlkLCDJtUpzb25PYmplY3QgfSBmcm9tICcuLi8uLi8uLi8uLi9wdWJsaWMvdHlwZXMnO1xuaW1wb3J0IHsgybVWYWxpZGF0aW9uVXRpbGl0aWVzIH0gZnJvbSAnLi4vLi4vLi4vZXhjZXB0aW9ucyc7XG5pbXBvcnQgeyDJtUNvbXBhcmlzb25UeXBlIH0gZnJvbSAnLi4vZW51bXMvY29tcGFyaXNvbi10eXBlLmVudW0nO1xuaW1wb3J0IHsgybVGaWx0ZXJUeXBlIH0gZnJvbSAnLi4vZW51bXMvZmlsdGVyLXR5cGUuZW51bSc7XG5pbXBvcnQgeyDJtUxvZ2ljYWxPcGVyYXRvclR5cGUgfSBmcm9tICcuLi9lbnVtcy9sb2dpY2FsLW9wZXJhdG9yLXR5cGUuZW51bSc7XG5pbXBvcnQgeyDJtUNvbHVtbkV4cHJlc3Npb24gfSBmcm9tICcuLi9leHByZXNzaW9ucy9jb2x1bW5zL2NvbHVtbi1leHByZXNzaW9uJztcbmltcG9ydCB7IMm1UGFyYW1ldGVyRXhwcmVzc2lvbiB9IGZyb20gJy4uL2V4cHJlc3Npb25zL3BhcmFtZXRlcnMvcGFyYW1ldGVyLWV4cHJlc3Npb24nO1xuXG5leHBvcnQgY2xhc3MgybVGaWx0ZXJHcm91cCBleHRlbmRzIMm1QmFzZUZpbHRlciB7XG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQGRvbnRDaGFuZ2Vcblx0ICovXG5cdHByb3RlY3RlZCBzdGF0aWMgcmVhZG9ubHkgX2luc3RhbmNlT2ZLZXk6IHN0cmluZyA9ICdkZXZraXRfRmlsdGVyR3JvdXAnO1xuXG5cdC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQGRvbnRDaGFuZ2Vcblx0ICovXG5cdHByb3RlY3RlZCBzdGF0aWMgZ2V0IF9pbnN0YW5jZU9mS2V5cygpOiBzdHJpbmdbXSB7XG5cdFx0cmV0dXJuIFsuLi7JtUJhc2VGaWx0ZXIuX2luc3RhbmNlT2ZLZXlzLCB0aGlzLl9pbnN0YW5jZU9mS2V5XTtcblx0fVxuXG5cdEBFeGNsdWRlKClcblx0cHVibGljIGZpbHRlcnMgPSBuZXcgTWFwPMm1R3VpZCwgybVCYXNlRmlsdGVyPigpO1xuXG5cdEBFeHBvc2UoKVxuXHRwdWJsaWMgZ2V0IGl0ZW1zKCk6IHsgW2tleTogc3RyaW5nXTogybVCYXNlRmlsdGVyIH0ge1xuXHRcdGNvbnN0IHJlc3VsdCA9IHt9O1xuXHRcdHRoaXMuZmlsdGVycy5mb3JFYWNoKChmaWx0ZXIsIGtleSkgPT4ge1xuXHRcdFx0cmVzdWx0W2tleV0gPSB0aGlzLnNlcmlhbGl6ZUl0ZW0oZmlsdGVyKTtcblx0XHR9KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9XG5cblx0cHVibGljIGxvZ2ljYWxPcGVyYXRpb246IMm1TG9naWNhbE9wZXJhdG9yVHlwZTtcblxuXHRjb25zdHJ1Y3Rvcihsb2dpY2FsT3BlcmF0aW9uID0gybVMb2dpY2FsT3BlcmF0b3JUeXBlLkFuZCkge1xuXHRcdHN1cGVyKMm1RmlsdGVyVHlwZS5GaWx0ZXJHcm91cCk7XG5cdFx0dGhpcy5sb2dpY2FsT3BlcmF0aW9uID0gbG9naWNhbE9wZXJhdGlvbjtcblx0fVxuXG5cdC8qKlxuXHQgKiBQYXJzZXMgZmlsdGVyIGdyb3VwIGZyb20ganNvbi5cblx0ICogQHB1YmxpY1xuXHQgKi9cblx0cHVibGljIHN0YXRpYyBmcm9tSnNvbjxUIGV4dGVuZHMgdHlwZW9mIMm1QmFzZUZpbHRlclBhcnNlcj4oZHRvOiDJtUpzb25PYmplY3QsIGZpbHRlclBhcnNlcjogVCk6IMm1RmlsdGVyR3JvdXAge1xuXHRcdGNvbnN0IGxvZ2ljYWxPcGVyYXRpb24gPSBkdG9bJ2xvZ2ljYWxPcGVyYXRpb24nXSBhcyDJtUxvZ2ljYWxPcGVyYXRvclR5cGU7XG5cdFx0Y29uc3QgZ3JvdXAgPSBuZXcgybVGaWx0ZXJHcm91cChsb2dpY2FsT3BlcmF0aW9uIHx8IMm1TG9naWNhbE9wZXJhdG9yVHlwZS5BbmQpO1xuXHRcdE9iamVjdC5lbnRyaWVzKGR0b1snaXRlbXMnXSBhcyDJtUpzb25PYmplY3QpLmZvckVhY2goKFtrZXksIGZpbHRlckRUT10pID0+IHtcblx0XHRcdGdyb3VwLmFkZChmaWx0ZXJQYXJzZXIuZnJvbUpzb24oZmlsdGVyRFRPIGFzIMm1SnNvbk9iamVjdCkgYXMgybVCYXNlRmlsdGVyLCBrZXkpO1xuXHRcdH0pO1xuXHRcdHJldHVybiBncm91cDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIGZpbHRlciBpdGVtIGJ5IGluZGV4LlxuXHQgKiBAcGFyYW0gaW5kZXggSXRlbSBpbmRleC5cblx0ICogQHJldHVybnMgRmlsdGVyLlxuXHQgKi9cblx0cHVibGljIGdldEl0ZW1CeUluZGV4KGluZGV4OiBudW1iZXIpOiDJtUJhc2VGaWx0ZXIge1xuXHRcdHJldHVybiB0aGlzLml0ZW1zW09iamVjdC5rZXlzKHRoaXMuaXRlbXMpW2luZGV4XV07XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhbmQgYWRkcyBjb21wYXJlIGZpbHRlciBieSB2YWx1ZS5cblx0ICogQHBhcmFtIGNvbXBhcmlzb25UeXBlIENvbXBhcmlzb24gdHlwZS5cblx0ICogQHBhcmFtIGNvbHVtblBhdGggQ29sdW1uIHBhdGguXG5cdCAqIEBwYXJhbSBwYXJhbWV0ZXJWYWx1ZSBQYXJhbWV0ZXIgdmFsdWUuXG5cdCAqIEBwYXJhbSBmaWx0ZXJLZXkgRmlsdGVyIGtleS5cblx0ICovXG5cdHB1YmxpYyBhZGRTY2hlbWFDb2x1bW5GaWx0ZXJXaXRoUGFyYW1ldGVyKFxuXHRcdGNvbXBhcmlzb25UeXBlOiDJtUNvbXBhcmlzb25UeXBlLFxuXHRcdGNvbHVtblBhdGg6IHN0cmluZyxcblx0XHRwYXJhbWV0ZXJWYWx1ZTogybVFbnRpdHlDb2x1bW5WYWx1ZSxcblx0XHRmaWx0ZXJLZXk/OiBzdHJpbmcsXG5cdCk6IHZvaWQge1xuXHRcdGNvbnN0IGxlZnRFeHByZXNzaW9uID0gbmV3IMm1Q29sdW1uRXhwcmVzc2lvbih7IGNvbHVtblBhdGggfSk7XG5cdFx0Y29uc3QgcmlnaHRFeHByZXNzaW9uID0gbmV3IMm1UGFyYW1ldGVyRXhwcmVzc2lvbih7IHZhbHVlOiBwYXJhbWV0ZXJWYWx1ZSB9KTtcblx0XHRjb25zdCBmaWx0ZXIgPSBuZXcgybVDb21wYXJlRmlsdGVyKGNvbXBhcmlzb25UeXBlLCBsZWZ0RXhwcmVzc2lvbiwgcmlnaHRFeHByZXNzaW9uKTtcblx0XHR0aGlzLmFkZChmaWx0ZXIsIGZpbHRlcktleSk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhbmQgYWRkcyBpbiBmaWx0ZXIgYnkgdmFsdWVzLlxuXHQgKiBAcGFyYW0gY29tcGFyaXNvblR5cGUgQ29tcGFyaXNvbiB0eXBlLlxuXHQgKiBAcGFyYW0gY29sdW1uUGF0aCBDb2x1bW4gcGF0aC5cblx0ICogQHBhcmFtIHBhcmFtZXRlclZhbHVlcyBQYXJhbWV0ZXIgdmFsdWVzLlxuXHQgKiBAcGFyYW0gZmlsdGVyS2V5IEZpbHRlciBrZXkuXG5cdCAqL1xuXHRwdWJsaWMgYWRkU2NoZW1hQ29sdW1uSW5GaWx0ZXJXaXRoUGFyYW1ldGVycyhcblx0XHRjb21wYXJpc29uVHlwZTogybVDb21wYXJpc29uVHlwZSxcblx0XHRjb2x1bW5QYXRoOiBzdHJpbmcsXG5cdFx0cGFyYW1ldGVyVmFsdWVzOiDJtUVudGl0eUNvbHVtblZhbHVlW10sXG5cdFx0ZmlsdGVyS2V5Pzogc3RyaW5nLFxuXHQpOiB2b2lkIHtcblx0XHRjb25zdCBsZWZ0RXhwcmVzc2lvbiA9IG5ldyDJtUNvbHVtbkV4cHJlc3Npb24oeyBjb2x1bW5QYXRoIH0pO1xuXHRcdGNvbnN0IGV4cHJlc3Npb25zID0gcGFyYW1ldGVyVmFsdWVzLm1hcChcblx0XHRcdChzaW5nbGVQYXJhbWV0ZXJWYWx1ZSkgPT5cblx0XHRcdFx0bmV3IMm1UGFyYW1ldGVyRXhwcmVzc2lvbih7XG5cdFx0XHRcdFx0dmFsdWU6IHNpbmdsZVBhcmFtZXRlclZhbHVlLFxuXHRcdFx0XHR9KSxcblx0XHQpO1xuXHRcdGNvbnN0IGZpbHRlciA9IG5ldyDJtUluRmlsdGVyKGNvbXBhcmlzb25UeXBlLCBsZWZ0RXhwcmVzc2lvbiwgZXhwcmVzc2lvbnMpO1xuXHRcdHRoaXMuYWRkKGZpbHRlciwgZmlsdGVyS2V5KTtcblx0fVxuXG5cdHB1YmxpYyBhZGRTY2hlbWFDb2x1bW5Jc051bGxGaWx0ZXIoY29sdW1uUGF0aDogc3RyaW5nLCBmaWx0ZXJLZXk/OiBzdHJpbmcpOiB2b2lkIHtcblx0XHRjb25zdCBsZWZ0RXhwcmVzc2lvbiA9IG5ldyDJtUNvbHVtbkV4cHJlc3Npb24oeyBjb2x1bW5QYXRoIH0pO1xuXHRcdGNvbnN0IGZpbHRlciA9IG5ldyDJtUlzTnVsbEZpbHRlcijJtUNvbXBhcmlzb25UeXBlLklzX251bGwsIGxlZnRFeHByZXNzaW9uKTtcblx0XHR0aGlzLmFkZChmaWx0ZXIsIGZpbHRlcktleSk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhbmQgYWRkcyBub3QgbnVsbCBmaWx0ZXIuXG5cdCAqIEBwYXJhbSBjb2x1bW5QYXRoIENvbHVtbiBwYXRoLlxuXHQgKiBAcGFyYW0gZmlsdGVyS2V5IEZpbHRlciBrZXkuXG5cdCAqL1xuXHRwdWJsaWMgYWRkU2NoZW1hQ29sdW1uSXNOb3ROdWxsRmlsdGVyKGNvbHVtblBhdGg6IHN0cmluZywgZmlsdGVyS2V5Pzogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3QgbGVmdEV4cHJlc3Npb24gPSBuZXcgybVDb2x1bW5FeHByZXNzaW9uKHsgY29sdW1uUGF0aCB9KTtcblx0XHRjb25zdCBmaWx0ZXIgPSBuZXcgybVJc051bGxGaWx0ZXIoybVDb21wYXJpc29uVHlwZS5Jc19ub3RfbnVsbCwgbGVmdEV4cHJlc3Npb24pO1xuXHRcdHRoaXMuYWRkKGZpbHRlciwgZmlsdGVyS2V5KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuZCBhZGRzIGZpbHRlciBiZXR3ZWVuIGxlc3MgdmFsdWUgYW5kIGdyZWF0ZXIgdmFsdWUuXG5cdCAqIEBwYXJhbSBjb2x1bW5QYXRoIENvbHVtbiBwYXRoLlxuXHQgKiBAcGFyYW0gbGVzc1BhcmFtVmFsdWUgTGVzcyBwYXJhbWV0ZXIgdmFsdWUuXG5cdCAqIEBwYXJhbSBncmVhdGVyUGFyYW1WYWx1ZSBHcmVhdGVyIHBhcmFtZXRlciB2YWx1ZS5cblx0ICogQHBhcmFtIGZpbHRlcktleSBGaWx0ZXIga2V5LlxuXHQgKi9cblx0cHVibGljIGFkZFNjaGVtYUNvbHVtbkJldHdlZW5GaWx0ZXJXaXRoUGFyYW1ldGVycyhcblx0XHRjb2x1bW5QYXRoOiBzdHJpbmcsXG5cdFx0bGVzc1BhcmFtVmFsdWU6IERhdGUgfCBudW1iZXIsXG5cdFx0Z3JlYXRlclBhcmFtVmFsdWU6IERhdGUgfCBudW1iZXIsXG5cdFx0ZmlsdGVyS2V5Pzogc3RyaW5nLFxuXHQpOiB2b2lkIHtcblx0XHRjb25zdCBsZWZ0RXhwcmVzc2lvbiA9IG5ldyDJtUNvbHVtbkV4cHJlc3Npb24oeyBjb2x1bW5QYXRoIH0pO1xuXHRcdGNvbnN0IHJpZ2h0TGVzc0V4cHJlc3Npb24gPSBuZXcgybVQYXJhbWV0ZXJFeHByZXNzaW9uKHsgdmFsdWU6IGxlc3NQYXJhbVZhbHVlIH0pO1xuXHRcdGNvbnN0IHJpZ2h0R3JlYXRlckV4cHJlc3Npb24gPSBuZXcgybVQYXJhbWV0ZXJFeHByZXNzaW9uKHsgdmFsdWU6IGdyZWF0ZXJQYXJhbVZhbHVlIH0pO1xuXHRcdGNvbnN0IGZpbHRlciA9IG5ldyDJtUJldHdlZW5GaWx0ZXIobGVmdEV4cHJlc3Npb24sIHJpZ2h0TGVzc0V4cHJlc3Npb24sIHJpZ2h0R3JlYXRlckV4cHJlc3Npb24pO1xuXHRcdHRoaXMuYWRkKGZpbHRlciwgZmlsdGVyS2V5KTtcblx0fVxuXG5cdHB1YmxpYyBhZGRFeGlzdHNGaWx0ZXIoY29sdW1uUGF0aDogc3RyaW5nLCBzdWJGaWx0ZXJzPzogybVGaWx0ZXJHcm91cCwgZmlsdGVyS2V5Pzogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3QgbGVmdEV4cHJlc3Npb24gPSBuZXcgybVDb2x1bW5FeHByZXNzaW9uKHsgY29sdW1uUGF0aCB9KTtcblx0XHRjb25zdCBmaWx0ZXIgPSBuZXcgybVFeGlzdHNGaWx0ZXIobGVmdEV4cHJlc3Npb24sIDzJtUZpbHRlckdyb3VwPnN1YkZpbHRlcnMpO1xuXHRcdHRoaXMuYWRkKGZpbHRlciwgZmlsdGVyS2V5KTtcblx0fVxuXG5cdHB1YmxpYyBhZGROb3RFeGlzdHNGaWx0ZXIoY29sdW1uUGF0aDogc3RyaW5nLCBzdWJGaWx0ZXJzPzogybVGaWx0ZXJHcm91cCwgZmlsdGVyS2V5Pzogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3QgbGVmdEV4cHJlc3Npb24gPSBuZXcgybVDb2x1bW5FeHByZXNzaW9uKHsgY29sdW1uUGF0aCB9KTtcblx0XHRjb25zdCBmaWx0ZXIgPSBuZXcgybVFeGlzdHNGaWx0ZXIobGVmdEV4cHJlc3Npb24sIDzJtUZpbHRlckdyb3VwPnN1YkZpbHRlcnMsIMm1Q29tcGFyaXNvblR5cGUuTm90X2V4aXN0cyk7XG5cdFx0dGhpcy5hZGQoZmlsdGVyLCBmaWx0ZXJLZXkpO1xuXHR9XG5cblx0cHVibGljIGFkZChmaWx0ZXI6IMm1QmFzZUZpbHRlciwgZmlsdGVyS2V5Pzogc3RyaW5nKTogdm9pZCB7XG5cdFx0ybVWYWxpZGF0aW9uVXRpbGl0aWVzLmNoZWNrQXJndW1lbnRFbXB0eSgnZmlsdGVyJywgZmlsdGVyKTtcblx0XHRjb25zdCBrZXkgPSBmaWx0ZXJLZXkgfHwgybVnZW5lcmF0ZUd1aWQoKTtcblx0XHR0aGlzLmZpbHRlcnMuc2V0KGtleSwgZmlsdGVyKTtcblx0fVxuXG5cdHB1YmxpYyBjbG9uZSgpOiDJtUZpbHRlckdyb3VwIHtcblx0XHRjb25zdCBmaWx0ZXJHcm91cCA9IG5ldyDJtUZpbHRlckdyb3VwKHRoaXMubG9naWNhbE9wZXJhdGlvbik7XG5cdFx0dGhpcy5maWx0ZXJzLmZvckVhY2goKGZpbHRlciwgZmlsdGVyS2V5KSA9PiB7XG5cdFx0XHRmaWx0ZXJHcm91cC5maWx0ZXJzLnNldChmaWx0ZXJLZXksIGZpbHRlci5jbG9uZSgpKTtcblx0XHR9KTtcblx0XHRyZXR1cm4gZmlsdGVyR3JvdXA7XG5cdH1cbn1cbiJdfQ==