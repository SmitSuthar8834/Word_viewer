{"ast":null,"code":"var _ = require(\"underscore\");\nexports.readNumberingXml = readNumberingXml;\nexports.Numbering = Numbering;\nexports.defaultNumbering = new Numbering({}, {});\nfunction Numbering(nums, abstractNums, styles) {\n  var allLevels = _.flatten(_.values(abstractNums).map(function (abstractNum) {\n    return _.values(abstractNum.levels);\n  }));\n  var levelsByParagraphStyleId = _.indexBy(allLevels.filter(function (level) {\n    return level.paragraphStyleId != null;\n  }), \"paragraphStyleId\");\n  function findLevel(numId, level) {\n    var num = nums[numId];\n    if (num) {\n      var abstractNum = abstractNums[num.abstractNumId];\n      if (!abstractNum) {\n        return null;\n      } else if (abstractNum.numStyleLink == null) {\n        return abstractNums[num.abstractNumId].levels[level];\n      } else {\n        var style = styles.findNumberingStyleById(abstractNum.numStyleLink);\n        return findLevel(style.numId, level);\n      }\n    } else {\n      return null;\n    }\n  }\n  function findLevelByParagraphStyleId(styleId) {\n    return levelsByParagraphStyleId[styleId] || null;\n  }\n  return {\n    findLevel: findLevel,\n    findLevelByParagraphStyleId: findLevelByParagraphStyleId\n  };\n}\nfunction readNumberingXml(root, options) {\n  if (!options || !options.styles) {\n    throw new Error(\"styles is missing\");\n  }\n  var abstractNums = readAbstractNums(root);\n  var nums = readNums(root, abstractNums);\n  return new Numbering(nums, abstractNums, options.styles);\n}\nfunction readAbstractNums(root) {\n  var abstractNums = {};\n  root.getElementsByTagName(\"w:abstractNum\").forEach(function (element) {\n    var id = element.attributes[\"w:abstractNumId\"];\n    abstractNums[id] = readAbstractNum(element);\n  });\n  return abstractNums;\n}\nfunction readAbstractNum(element) {\n  var levels = {};\n  element.getElementsByTagName(\"w:lvl\").forEach(function (levelElement) {\n    var levelIndex = levelElement.attributes[\"w:ilvl\"];\n    var numFmt = levelElement.firstOrEmpty(\"w:numFmt\").attributes[\"w:val\"];\n    var paragraphStyleId = levelElement.firstOrEmpty(\"w:pStyle\").attributes[\"w:val\"];\n    levels[levelIndex] = {\n      isOrdered: numFmt !== \"bullet\",\n      level: levelIndex,\n      paragraphStyleId: paragraphStyleId\n    };\n  });\n  var numStyleLink = element.firstOrEmpty(\"w:numStyleLink\").attributes[\"w:val\"];\n  return {\n    levels: levels,\n    numStyleLink: numStyleLink\n  };\n}\nfunction readNums(root) {\n  var nums = {};\n  root.getElementsByTagName(\"w:num\").forEach(function (element) {\n    var numId = element.attributes[\"w:numId\"];\n    var abstractNumId = element.first(\"w:abstractNumId\").attributes[\"w:val\"];\n    nums[numId] = {\n      abstractNumId: abstractNumId\n    };\n  });\n  return nums;\n}","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}