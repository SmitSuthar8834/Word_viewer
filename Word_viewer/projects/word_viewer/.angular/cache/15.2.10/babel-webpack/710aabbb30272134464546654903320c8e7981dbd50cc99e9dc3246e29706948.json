{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Lenovo/Desktop/WORD_viewer/Word_viewer/projects/word_viewer/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate, __metadata } from \"tslib\";\nimport { EventEmitter } from \"@angular/core\";\nimport { CrtInterfaceDesignerItem, CrtViewElement, CrtInput, CrtOutput } from \"@creatio-devkit/common\";\nimport * as mammoth from 'mammoth';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nfunction WordViewerComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1, \" Loading document... \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction WordViewerComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.error, \" \");\n  }\n}\nfunction WordViewerComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"div\", 10);\n    i0.ɵɵelement(2, \"div\", 11);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r2.convertedHtml, i0.ɵɵsanitizeHtml);\n  }\n}\nlet WordViewerComponent = class WordViewerComponent {\n  constructor() {\n    this._documentUrl = '';\n    this._documentContent = '';\n    this._attachmentId = '';\n    this._schemaName = '';\n    this.loadingStateChange = new EventEmitter();\n    this.errorChange = new EventEmitter();\n    this.isLoading = false;\n    this.error = null;\n    this.currentDate = new Date();\n    this.convertedHtml = '';\n  }\n  set documentUrl(value) {\n    console.log('Document URL received:', value);\n    this._documentUrl = value || '';\n    this.loadDocument();\n  }\n  get documentUrl() {\n    return this._documentUrl;\n  }\n  set documentContent(value) {\n    console.log('Document content received:', value);\n    this._documentContent = value || '';\n    this.loadDocument();\n  }\n  get documentContent() {\n    return this._documentContent;\n  }\n  set attachmentId(value) {\n    console.log('Attachment ID received:', value);\n    this._attachmentId = value || '';\n    if (this._attachmentId && this._schemaName) {\n      this.loadAttachment();\n    }\n  }\n  get attachmentId() {\n    return this._attachmentId;\n  }\n  set schemaName(value) {\n    console.log('Schema name received:', value);\n    this._schemaName = value || '';\n    if (this._attachmentId && this._schemaName) {\n      this.loadAttachment();\n    }\n  }\n  get schemaName() {\n    return this._schemaName;\n  }\n  ngOnInit() {\n    console.log('Component initialized with:', {\n      documentUrl: this.documentUrl,\n      documentContent: this.documentContent,\n      attachmentId: this.attachmentId,\n      schemaName: this.schemaName\n    });\n  }\n  setLoading(loading) {\n    this.isLoading = loading;\n    this.loadingStateChange.emit(loading);\n  }\n  setError(error) {\n    this.error = error;\n    if (error) {\n      this.errorChange.emit(error);\n    }\n  }\n  loadAttachment() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (!_this.attachmentId || !_this.schemaName) {\n        _this.setError(\"Attachment ID or Schema Name not provided\");\n        return;\n      }\n      try {\n        _this.setLoading(true);\n        // Here implement the attachment loading logic using Creatio services\n        // This would typically involve querying the attachment and setting documentContent\n        _this.setLoading(false);\n      } catch (err) {\n        _this.setError(\"Failed to load attachment\");\n        _this.setLoading(false);\n      }\n    })();\n  }\n  loadDocument() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this2.documentUrl && !_this2.documentContent) {\n        _this2.setError(\"No document provided\");\n        return;\n      }\n      try {\n        _this2.setLoading(true);\n        if (_this2.documentContent) {\n          // Convert base64 string to ArrayBuffer\n          const binaryString = window.atob(_this2.documentContent);\n          const bytes = new Uint8Array(binaryString.length);\n          for (let i = 0; i < binaryString.length; i++) {\n            bytes[i] = binaryString.charCodeAt(i);\n          }\n          const result = yield mammoth.convertToHtml({\n            arrayBuffer: bytes.buffer\n          });\n          _this2.convertedHtml = result.value;\n        } else if (_this2.documentUrl) {\n          const response = yield fetch(_this2.documentUrl);\n          const arrayBuffer = yield response.arrayBuffer();\n          const result = yield mammoth.convertToHtml({\n            arrayBuffer\n          });\n          _this2.convertedHtml = result.value;\n        }\n        _this2.setLoading(false);\n      } catch (err) {\n        console.error('Document conversion error:', err);\n        _this2.setError(\"Failed to load document\");\n        _this2.setLoading(false);\n      }\n    })();\n  }\n  static {\n    this.ɵfac = function WordViewerComponent_Factory(t) {\n      return new (t || WordViewerComponent)();\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: WordViewerComponent,\n      selectors: [[\"qnovate-word-viewer\"]],\n      inputs: {\n        documentUrl: \"documentUrl\",\n        documentContent: \"documentContent\",\n        attachmentId: \"attachmentId\",\n        schemaName: \"schemaName\"\n      },\n      outputs: {\n        loadingStateChange: \"loadingStateChange\",\n        errorChange: \"errorChange\"\n      },\n      decls: 8,\n      vars: 4,\n      consts: [[1, \"word-viewer-container\"], [1, \"toolbar\"], [3, \"disabled\", \"click\"], [1, \"content-area\"], [\"class\", \"loading\", 4, \"ngIf\"], [\"class\", \"error\", 4, \"ngIf\"], [\"class\", \"document-content\", 4, \"ngIf\"], [1, \"loading\"], [1, \"error\"], [1, \"document-content\"], [1, \"page\"], [3, \"innerHTML\"]],\n      template: function WordViewerComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"button\", 2);\n          i0.ɵɵlistener(\"click\", function WordViewerComponent_Template_button_click_2_listener() {\n            return ctx.loadDocument();\n          });\n          i0.ɵɵtext(3, \" Load Document \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(4, \"div\", 3);\n          i0.ɵɵtemplate(5, WordViewerComponent_div_5_Template, 2, 0, \"div\", 4);\n          i0.ɵɵtemplate(6, WordViewerComponent_div_6_Template, 2, 1, \"div\", 5);\n          i0.ɵɵtemplate(7, WordViewerComponent_div_7_Template, 3, 1, \"div\", 6);\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", ctx.isLoading);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.error);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.isLoading && !ctx.error);\n        }\n      },\n      dependencies: [i1.NgIf],\n      styles: [\".word-viewer-container{display:flex;flex-direction:column;height:100%;width:100%;background:#f5f5f5}.word-viewer-container .toolbar{padding:12px;background:#fff;border-bottom:1px solid #e0e0e0;box-shadow:0 2px 4px #0000001a}.word-viewer-container .toolbar button{padding:8px 16px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px}.word-viewer-container .toolbar button:disabled{background:#cccccc}.word-viewer-container .toolbar button:hover:not(:disabled){background:#0056b3}.word-viewer-container .content-area{flex:1;padding:24px;overflow-y:auto}.word-viewer-container .content-area .loading{display:flex;justify-content:center;align-items:center;height:200px;font-size:16px;color:#666}.word-viewer-container .content-area .error{color:#dc3545;padding:16px;text-align:center;background:#f8d7da;border-radius:4px;margin:16px}.word-viewer-container .content-area .document-content .page{background:white;padding:48px;margin:0 auto;max-width:816px;min-height:1056px;box-shadow:0 2px 8px #00000026}.word-viewer-container .content-area .document-content .page ::ng-deep h1,.word-viewer-container .content-area .document-content .page ::ng-deep h2,.word-viewer-container .content-area .document-content .page ::ng-deep h3,.word-viewer-container .content-area .document-content .page ::ng-deep h4,.word-viewer-container .content-area .document-content .page ::ng-deep h5,.word-viewer-container .content-area .document-content .page ::ng-deep h6{margin-top:1em;margin-bottom:.5em;color:#333}.word-viewer-container .content-area .document-content .page ::ng-deep p{margin:0 0 1em;line-height:1.6}.word-viewer-container .content-area .document-content .page ::ng-deep ul,.word-viewer-container .content-area .document-content .page ::ng-deep ol{margin:1em 0;padding-left:2em}.word-viewer-container .content-area .document-content .page ::ng-deep table{border-collapse:collapse;margin:1em 0}.word-viewer-container .content-area .document-content .page ::ng-deep table th,.word-viewer-container .content-area .document-content .page ::ng-deep table td{border:1px solid #ddd;padding:8px}\\n\"],\n      encapsulation: 3\n    });\n  }\n};\n__decorate([CrtInput(), __metadata(\"design:type\", String), __metadata(\"design:paramtypes\", [String])], WordViewerComponent.prototype, \"documentUrl\", null);\n__decorate([CrtInput(), __metadata(\"design:type\", String), __metadata(\"design:paramtypes\", [String])], WordViewerComponent.prototype, \"documentContent\", null);\n__decorate([CrtInput(), __metadata(\"design:type\", String), __metadata(\"design:paramtypes\", [String])], WordViewerComponent.prototype, \"attachmentId\", null);\n__decorate([CrtInput(), __metadata(\"design:type\", String), __metadata(\"design:paramtypes\", [String])], WordViewerComponent.prototype, \"schemaName\", null);\n__decorate([CrtOutput(), __metadata(\"design:type\", Object)], WordViewerComponent.prototype, \"loadingStateChange\", void 0);\n__decorate([CrtOutput(), __metadata(\"design:type\", Object)], WordViewerComponent.prototype, \"errorChange\", void 0);\nWordViewerComponent = __decorate([CrtViewElement({\n  selector: \"qnovate-word-viewer\",\n  type: \"qnovate.WordViewer\"\n}), CrtInterfaceDesignerItem({\n  toolbarConfig: {\n    caption: \"Word Viewer\",\n    name: \"qnovate-word-viewer\",\n    icon: require(\"!!raw-loader?{esModule:false}!./word-viewer-icon.svg\")\n  }\n})], WordViewerComponent);\nexport { WordViewerComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}