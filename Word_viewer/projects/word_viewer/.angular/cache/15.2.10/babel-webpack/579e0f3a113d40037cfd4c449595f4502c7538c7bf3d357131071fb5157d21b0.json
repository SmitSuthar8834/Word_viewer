{"ast":null,"code":"\"use strict\";\n\nmodule.exports = function (Promise) {\n  var longStackTraces = false;\n  var contextStack = [];\n  Promise.prototype._promiseCreated = function () {};\n  Promise.prototype._pushContext = function () {};\n  Promise.prototype._popContext = function () {\n    return null;\n  };\n  Promise._peekContext = Promise.prototype._peekContext = function () {};\n  function Context() {\n    this._trace = new Context.CapturedTrace(peekContext());\n  }\n  Context.prototype._pushContext = function () {\n    if (this._trace !== undefined) {\n      this._trace._promiseCreated = null;\n      contextStack.push(this._trace);\n    }\n  };\n  Context.prototype._popContext = function () {\n    if (this._trace !== undefined) {\n      var trace = contextStack.pop();\n      var ret = trace._promiseCreated;\n      trace._promiseCreated = null;\n      return ret;\n    }\n    return null;\n  };\n  function createContext() {\n    if (longStackTraces) return new Context();\n  }\n  function peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n      return contextStack[lastIndex];\n    }\n    return undefined;\n  }\n  Context.CapturedTrace = null;\n  Context.create = createContext;\n  Context.deactivateLongStackTraces = function () {};\n  Context.activateLongStackTraces = function () {\n    var Promise_pushContext = Promise.prototype._pushContext;\n    var Promise_popContext = Promise.prototype._popContext;\n    var Promise_PeekContext = Promise._peekContext;\n    var Promise_peekContext = Promise.prototype._peekContext;\n    var Promise_promiseCreated = Promise.prototype._promiseCreated;\n    Context.deactivateLongStackTraces = function () {\n      Promise.prototype._pushContext = Promise_pushContext;\n      Promise.prototype._popContext = Promise_popContext;\n      Promise._peekContext = Promise_PeekContext;\n      Promise.prototype._peekContext = Promise_peekContext;\n      Promise.prototype._promiseCreated = Promise_promiseCreated;\n      longStackTraces = false;\n    };\n    longStackTraces = true;\n    Promise.prototype._pushContext = Context.prototype._pushContext;\n    Promise.prototype._popContext = Context.prototype._popContext;\n    Promise._peekContext = Promise.prototype._peekContext = peekContext;\n    Promise.prototype._promiseCreated = function () {\n      var ctx = this._peekContext();\n      if (ctx && ctx._promiseCreated == null) ctx._promiseCreated = this;\n    };\n  };\n  return Context;\n};","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}